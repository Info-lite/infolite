<h2>ルビーン検定</h2>
<section>
<div id="purpose">
<h2>本付録の目的</h2>
<ul>
 	<li>ルビーン検定の概要を知る</li>
 	<li>Excelを用いてルビーン検定を行う</li>
</ul>
</div>
</section>

<hr>

<section>
<div id="toc">
<h2>目次</h2>
<ol>
 	<li><a href="#section1">等分散性の検定</a></li>
 	<li><a href="#section2">ルビーン検定</a>
<ol>
 	<li><a href="#section2.1">練習問題1</a></li>
 	<li><a href="#section2.2">仮説の設定</a></li>
 	<li><a href="#section2.3">有意水準αの設定</a></li>
 	<li><a href="#section2.4">検定統計量$latex W$値の算出</a></li>
 	<li><a href="#section2.5">p値の算出</a></li>
 	<li><a href="#section2.6">判定</a></li>
 	<li><a href="#section2.7">Excelの操作</a></li>
 	<li><a href="#section2.8">結果</a></li>
</ol>
</li>
</ol>
</div>
</section>

<hr>

<section>
<div id="NB">
<h2>注意</h2>
<strong>練習で使ったデータは必ず保存するようにしましょう。</strong>

</div>
</section>

<hr>

<section>
<div id="section1">
<h2>等分散性の検定</h2>
<a href="../class03/">2つのグループの母平均の差に関する検定</a>を行う場合、<a href="../class03/#section1.1">対応のないデータ</a>に対しては、まず、2つのグループ（群、水準）の母<a href="../class01/#variance">分散</a>が等しいかを調べる<a href="../class03/#homogeneity_of_variance_test">等分散性（homogeneity of variance）の検定</a>を行う必要があります。ここでは、等分散性の検定法として<span id="levene_s_test">ルビーン検定</span>（Levene's test）を行います。

</div>
</section>
<section>
<div id="section2">
<h2>ルビーン検定</h2>
<section>
<div id="section2.1">
<h3>練習問題1</h3>
ここでは、例として、<a href="../class03/#section2">対応のないデータに対して等分散を仮定したときの2つの母平均の差の検定</a>の<a href="../class03/#section2.1">練習問題1</a>を利用します。
<blockquote>ある学校のＡ組とＢ組のテスト結果について調べたところ、以下のような標本が得られました。
<figure style="display:table;" id="table1"><figcaption style="display:table-caption;text-align:center;">
<div>表1：ある学校のテスト結果（点）</div>
</figcaption><img src="https://infolit.uec.tmu.ac.jp/lit/contents/jmp/03/pic/03_01exQ.png" alt="表1：ある学校のテスト結果（点）"></figure>
</blockquote>
この2グループに対して、等分散性を検定してみましょう。

</div>
</section>
<section>
<div id="section2.2">
<h3>仮説の設定</h3>
<ul>
 	<li><a href="../class02/#null_hypothesis">帰無仮説</a>H<sub>0</sub>：両グループの母<a href="../class01/#variance">分散</a>は等しい（μ<sub>A</sub> = μ<sub>B</sub>）</li>
 	<li><a href="../class02/#alternative_hypothesis">対立仮説</a>H<sub>1</sub>：両グループの母分散は異なる（μ<sub>A</sub> ≠ μ<sub>B</sub>）</li>
</ul>
</div>
</section>
<section>
<div id="section2.3">
<h3>有意水準αの設定</h3>
<a href="../class04/#section1">有意水準</a>α = 0.05とします。

</div>
</section>
<section>
<div id="section2.4">
<h3>検定統計量$latex W$値の算出</h3>
Ａ組とＢ組の2グループの等分散性の検定の場合、<a href="../class02/#test_statistic">検定統計量</a>$latex W$は以下の数式で求まります。
$latex \displaystyle W = \frac{N_\text{A}{\left( \Bar{Z}_\text{A} - \Bar{Z} \right)}^2 + N_\text{B}{\left( \Bar{Z}_\text{B} - \Bar{Z} \right)}^2}{\frac{ S_{Z_\text{A}} + S_{Z_\text{B}}}{\left( N_\text{A} - 1 \right) + \left( N_\text{B} - 1 \right)}}$
<ul>
 	<li>$latex N_\text{A}$：Ａ組の<a href="../class01/#sample_size">標本の大きさ</a></li>
 	<li>$latex N_\text{B}$：Ｂ組の標本の大きさ</li>
 	<li>$latex \displaystyle \Bar{Z}_\text{A} = \frac{1}{N_\text{A}} \sum_{i=1}^{N_\text{A}} Z_{\text{A}i}$：Ａ組の標本の<span id="absolute_deviation">絶対偏差</span>（<a href="../class01/#deviation">偏差</a>の絶対値）の<a href="../class01/#mean">平均</a></li>
 	<li>$latex \displaystyle \Bar{Z}_\text{B} = \frac{1}{N_\text{B}} \sum_{j=1}^{N_\text{B}} Z_{\text{B}j}$：Ｂ組の標本の絶対偏差の平均</li>
 	<li>$latex \displaystyle \Bar{Z} = \frac{1}{N_\text{A} + N_\text{B}} \left( \sum_{i=1}^{N_\text{A}} Z_{\text{A}i} + \sum_{j=1}^{N_\text{B}} Z_{\text{B}j} \right)$：Ａ組の<a href="../class02/#sample">標本</a>の絶対偏差とＢ組の標本の絶対偏差全体の平均</li>
 	<li>$latex \displaystyle S_{Z_\text{A}} = \sum_{i = 1}^{N_A} {\left( Z_{\text{A}i} - \Bar{Z}_\text{A} \right)}^2$：Ａ組の標本の絶対偏差の<a href="../class01/#sum_of_squared_deviations">偏差平方和</a></li>
 	<li>$latex \displaystyle S_{Z_\text{B}} = \sum_{j = 1}^{N_B} {\left( Z_{\text{B}j} - \Bar{Z}_\text{B} \right)}^2$：Ｂ組の標本の絶対偏差の偏差平方和</li>
 	<li>$latex Z_{\text{A}i} = \left| x_{\text{A}i} - \Bar{x}_\text{A} \right|$：Ａ組の標本の$latex i$番目の測定値の絶対偏差</li>
 	<li>$latex Z_{\text{B}j} = \left| x_{\text{B}j} - \Bar{x}_\text{B} \right|$：Ｂ組の標本の$latex j$番目の測定値の絶対偏差</li>
 	<li>$latex x_{\text{A}i}$：Ａ組の標本の$latex i$番目の測定値</li>
 	<li>$latex x_{\text{B}j}$：Ｂ組の標本の$latex j$番目の測定値</li>
 	<li>$latex \displaystyle \Bar{x}_\text{A} = \sum_{i=1}^{N_\text{A}} x_{\text{A}i}$：Ａ組の<a href="../class02/#sample_mean">標本平均</a></li>
 	<li>$latex \displaystyle \Bar{x}_\text{B} = \sum_{i=j}^{N_\text{B}} x_{\text{B}j}$：Ｂ組の標本平均</li>
</ul>
検定統計量$latex W$は標本の絶対偏差に基づくグループ間の<a href="../class01/#variance">不偏分散（偏差平方和を自由度で割った値）</a>$latex \displaystyle N_\text{A}{\left( \Bar{Z}_\text{A} - \Bar{Z} \right)}^2 + N_\text{B}{\left( \Bar{Z}_\text{B} - \Bar{Z} \right)}^2$と標本の絶対偏差に基づくグループ内の不偏分散
$latex \displaystyle \frac{\displaystyle \sum_{i=1}^{N_\text{A}} {\left( Z_{\text{A}i} - \Bar{Z}_\text{A} \right)}^2 + \sum_{j=1}^{N_\text{B}} {\left( Z_{\text{B}j} - \Bar{Z}_\text{B} \right)}^2}{\left( N_\text{A} - 1 \right) + \left( N_\text{B} - 1 \right)}$
との比で、<a href="../class02/#null_hypothesis">帰無仮説</a>が成立する場合、$latex W$は自由度が(1, $latex N_\text{A} - 1 + N_\text{B} - 1$)の<span id="f-distribution">F分布</span>に従うことがわかっています。

</div>
</section>
<section>
<div id="section2.5">
<h3>p値の算出</h3>
<a href="../class04/#section1">有意水準</a>αと比較する確率p値を算出します。<span id="p_of_W">p値</span>は、自由度が(1, $latex N_\text{A} - 1 + N_\text{B} - 1$)の<a href="#f-distribution">F分布</a>において$latex W$より大きい値が発生する確率です。<a href="../class02/#null_hypothesis">帰無仮説</a>（<q>両グループの母分散は等しい（μ<sub>A</sub> =&nbsp;μ<sub>B</sub>）</q>）が成立していれば、<a href="../class02/#sample">標本</a>の<a href="#absolute_deviation">絶対偏差</a>に基づくグループ間の<a href="../class01/#variance">不偏分散</a>（グループ間のばらつき、$latex W$の分子）は小さくなり、結果として$latex W$も小さくなるため、p値は大きくなります。逆に帰無仮説が成立しない場合は、$latex W$は大きいためp値は小さくなります。

</div>
</section>
<section>
<div id="section2.6">
<h3>判定</h3>
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/f_pdf.png" alt="F分布">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>F分布</div>
</figcaption></figure>
<a href="#f-distribution">F分布</a>はこのようなグラフを描きます。このグラフで<a href="#p_of_W">p値</a>を表す面積が<a href="../class04/#section1">有意水準</a>の確率を表す面積より大きいか小さいかで<a href="../class02/#null_hypothesis">帰無仮説</a>の受容か棄却かを決定します。なお、図のとおり、自由度によって、このF分布のグラフは変わります。
<dl>
 	<dt>p値 ≦ 有意水準α</dt>
 	<dd>帰無仮説H<sub>0</sub>を棄却する</dd>
 	<dt>p値 &gt; 有意水準α</dt>
 	<dd>帰無仮説H<sub>0</sub>を受容する</dd>
</dl>
</div>
</section>
<section>
<div id="section2.7">
<h3>Excelの操作</h3>
ここまで検定の理論について説明してきましたが、Excelを用いて<a href="#section2.1">練習問題1</a>に取り掛かりましょう。
<ol style="list-style-type:circled-decimal;">
 	<li><a href="#table1">表1</a>のデータをExcelに入力します。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_06input.png" alt="データの入力">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>データの入力</div>
</figcaption></figure>
</li>
 	<li>グループごとにデータの<a href="#absolute_deviation">絶対偏差</a>を求めるための項目を入力します。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_07input.png" alt="絶対偏差用項目の入力">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>絶対偏差用項目の入力</div>
</figcaption></figure>
</li>
 	<li>"D3"セルに<code>=ABS(A3-AVERAGE(A$3:A$13))</code>と入力し、<a href="../class01/#autofill">オートフィル</a>を使ってＡ組の標本のすべての測定値に対して絶対偏差を求めます。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_08input.png" alt="Ａ組の標本の絶対偏差1">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>Ａ組の標本の絶対偏差1</div>
</figcaption></figure>
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_09input.png" alt="Ａ組の標本の絶対偏差2">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>Ａ組の標本の絶対偏差2</div>
</figcaption></figure>
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_10input.png" alt="Ａ組の標本の絶対偏差のオートフィル">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>Ａ組の標本の絶対偏差のオートフィル</div>
</figcaption></figure>
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_11input.png" alt="Ａ組の標本の絶対偏差のオートフィル後">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>Ａ組の標本の絶対偏差のオートフィル後</div>
</figcaption></figure>
<code>ABS</code>関数によって絶対偏差を求めています（<a href="https://support.office.com/ja-jp/article/ABS-関数-3420200f-5628-4e8c-99da-c99d7c87713c"><code>ABS</code>関数</a>）。</li>
 	<li>同様に、"E3"セルに<code>=ABS(B3-AVERAGE(B$3:B$11))</code>と入力し、オートフィルを使ってＢ組の標本のすべての測定値に対して絶対偏差を求めます。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_15input.png" alt="Ｂ組の標本の絶対偏差のオートフィル後">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>Ｂ組の標本の絶対偏差のオートフィル後</div>
</figcaption></figure>
</li>
 	<li>ルビーン検定用の項目を入力し、既知のデータを入力します。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_16input.png" alt="ルビーン検定用の項目">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>ルビーン検定用の項目</div>
</figcaption></figure>
</li>
 	<li>ルビーン検定用のデータを算出するために、以下のように入力します。
<ul>
 	<li>"H8"：<code>=AVERAGE(D3:D13)</code>（Ａ組の標本の絶対偏差の平均）</li>
 	<li>"I8"：<code>=AVERAGE(E3:E11)</code>（Ｂ組の標本の絶対偏差の平均）</li>
 	<li>"J8"：<code>=AVERAGE(D3:D13,E3:E11)</code>（標本全体の絶対偏差の平均）</li>
 	<li>"H9"：<code>=COUNTA(D3:D13)*(H8-J8)^2</code>（Ａ組の標本の絶対偏差の平均と標本全体の絶対偏差の平均との<a href="../class01/#sum_of_squared_deviations">偏差平方和</a>）</li>
 	<li>"I9"：<code>=COUNTA(E3:E11)*(I8-J8)^2</code>（Ｂ組の標本の絶対偏差の平均と標本全体の絶対偏差の平均との偏差平方和）</li>
 	<li>"K9"：<code>=SUM(H9:I9)</code>（グループ間の偏差平方和）</li>
 	<li>"J10"：<code>1</code>（グループ間の<a href="../class01/#variance">不偏分散</a>の自由度）</li>
 	<li>"J11"：<code>=K9/J10</code>（グループ間の不偏分散）</li>
 	<li>"H15"：<code>=DEVSQ(D3:D13)</code>（Ａ組の標本の絶対偏差の偏差平方和）</li>
 	<li>"I15"：<code>=DEVSQ(E3:E11)</code>（Ｂ組の標本の絶対偏差の偏差平方和）</li>
 	<li>"K15"：<code>=SUM(H15:I15)</code>（グループ内の偏差平方和）</li>
 	<li>"H16"：<code>=COUNTA(D3:D13)-1</code>（Ａ組の不偏分散の自由度）</li>
 	<li>"I16"：<code>=COUNTA(E3:E11)-1</code>（Ｂ組の不偏分散の自由度）</li>
 	<li>"K16"：<code>=SUM(H16:I16)</code>（グループ内の不偏分散の自由度）</li>
 	<li>"J17"：<code>=K15/K16</code>（グループ内の不偏分散）</li>
 	<li>"H2"：<code>=J11/J17</code>（<a href="#section2.4">検定統計量$latex W$</a>）</li>
 	<li>"H3"：<code>=F.DIST.RT(H2,J10,K16)</code>（<a href="#p_of_W">p値</a>）</li>
</ul>
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_17input1.png" alt="ルビーン検定用のデータ">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>ルビーン検定用のデータ</div>
</figcaption></figure>
なお、<code>DEVSQ</code>関数は、与えられたデータの平均とそれぞれのデータとの差を二乗して合計した値、すなわち、偏差平方和を求めます（<a href="https://support.office.com/ja-jp/article/DEVSQ-関数-8b739616-8376-4df5-8bd0-cfe0a6caf444"><code>DEVSQ</code>関数</a>）。また、<code>F.DIST.RT(</code>$latex W$<code>,1,</code>$latex N_\text{A} - 1 + N_\text{B} - 1$<code>)</code>は、自由度(1, $latex N_\text{A} - 1 + N_\text{B} - 1$)のF分布において、$latex W$より大きい値が発生する確率を与えます（<a href="https://support.office.com/ja-jp/article/F-DIST-RT-関数-d74cbb00-6017-4ac9-b7d7-6049badc0520"><code>F.DIST.RT</code>関数</a>）。</li>
</ol>
</div>
</section>
<section>
<div id="section2.8">
<h3>結果</h3>
<a href="#p_of_W">p値</a> = 0.930135が求まりました。下図の塗りつぶされた領域が全体に対してpの割合になっています。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/10/03_practice1_w.png" alt="p値の図示">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>p値の図示</div>
</figcaption></figure>
設定した<a href="../class04/#section1">有意水準</a>αは0.05です。p値 = 0.930135 &gt; 有意水準α = 0.05であるので、<a href="../class02/#null_hypothesis">帰無仮説</a>H<sub>0</sub>は棄却されません。したがって、Ａ組のテスト結果とＢ組のテスト結果とは等<a href="../class01/#variance">分散</a>を仮定できます。

</div>
</section></div>
</section>

<hr>

<footer id="copyright">
本教材に掲載する製品名は、一般に各開発メーカの商標、または登録商標です。
© 2016，2017 Masaaki FUJIYOSHI.</footer>
