<h2>フィッシャーの正確確率検定</h2>
<section>
<div id="purpose">
<h2>本付録の目的</h2>
<ul>
 	<li>フィッシャーの正確確率検定の概要を知る</li>
 	<li>Excelを用いてフィッシャーの正確確率検定を行う</li>
</ul>
</div>
</section>

<hr>

<section>
<div id="toc">
<h2>目次</h2>
<ol>
 	<li><a href="#section1">分割表の検定</a></li>
 	<li><a href="#section2">フィッシャーの正確確率検定</a>
<ol>
 	<li><a href="#section2.1">練習問題1</a></li>
 	<li><a href="#section2.2">仮説の設定</a></li>
 	<li><a href="#section2.3">有意水準αの設定</a></li>
 	<li><a href="#section2.4">$latex p_i$値の算出</a></li>
 	<li><a href="#section2.5">p値の算出</a></li>
 	<li><a href="#section2.6">判定</a></li>
 	<li><a href="#section2.7">Excelの操作</a></li>
 	<li><a href="#section2.8">結果</a></li>
</ol>
</li>
</ol>
</div>
</section>

<hr>

<section>
<div id="NB">
<h2>注意</h2>
<strong>練習で使ったデータは必ず保存するようにしましょう。</strong>

</div>
</section>

<hr>

<section>
<div id="section1">
<h2>分割表の検定</h2>
<a href="../class04/#section3">分割表の検定</a>に<a href="../class04/#pearson_s_chi2-test">ピアソンの$latex \chi^2$検定</a>を用いることができるのは、基本的に<a href="../class04/#grand_total">総数</a>が大きい場合です。その他の場合は、<span id="fisher_s_exact_test">フィッシャーの正確確率検定</span>（Fisher's exact test）を用いて検定します。なお、ピアソンの$latex \chi^2$検定を用いることができる場合でも、フィッシャーの正確確率検定を用いて構いません。

</div>
</section>
<section>
<div id="section2">
<h2>フィッシャーの正確確率検定</h2>
<section>
<div id="section2.1">
<h3>練習問題1</h3>
ここでは、例として、<a href="../class04/#section2">分割表（クロス集計表）の分析</a>の<a href="../class04/#section2.2">練習問題1</a>を利用します。
<blockquote>次のデータは、ある地域の成人男性25人、女性25人の合計50人に、今住んでいる地域に愛着が有るか無いかの意見を聞き、その結果を表にしたものです。このデータを集計し、<a href="../class04/#contingency_table">分割表</a>に整理しましょう。
<figure id="table1" style="display:table;"><figcaption style="display:table-caption;text-align:center;">
<div>表1：ある地域の愛着に対する意見</div>
</figcaption><img src="https://infolit.uec.tmu.ac.jp/lit/contents/jmp/04/pic/04_05exQ.png" alt="ある地域の愛着に対する意見"></figure>
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2016/11/04_11analysis.png?w=776" alt="分割表（拡大）">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>分割表（拡大）</div>
</figcaption></figure>
</blockquote>
この分割表に対して、母比の差を検定してみましょう。

</div>
</section>
<section>
<div id="section2.2">
<h3>仮説の設定</h3>
<ul>
 	<li><a href="../class02/#null_hypothesis">帰無仮説</a>H<sub>0</sub>：愛着ありと愛着なしとの度数の比は男性と女性とで等しい</li>
 	<li><a href="../class02/#alternative_hypothesis">対立仮説</a>H<sub>1</sub>：愛着ありと愛着なしとの度数の比は男性と女性とで等しくない</li>
</ul>
</div>
</section>
<section>
<div id="section2.3">
<h3>有意水準αの設定</h3>
<a href="../class04/#section1">有意水準</a>α = 0.05とします。

</div>
</section>
<section>
<div id="section2.4">
<h3>$latex p_i$値の算出</h3>
<a href="../class04/#row_marginal_total">行周辺合計</a>と<a href="../class04/#column_marginal_total">列周辺合計</a>とを固定した分割表
<table id="fixed_marginal" style="width:auto;border-collapse:collapse;">
<thead>
<tr>
<th style="text-align:center;border:1px solid black;"></th>
<th style="text-align:center;border:1px solid black;">有り</th>
<th style="text-align:center;border:1px solid black;">無し</th>
<th style="text-align:center;border:1px solid black;">総計</th>
</tr>
</thead>
<tbody>
<tr>
<th style="text-align:center;border:1px solid black;">女性</th>
<td style="text-align:right;border:1px solid black;">$latex a$</td>
<td style="text-align:right;border:1px solid black;">$latex b$</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">男性</th>
<td style="text-align:right;border:1px solid black;">$latex c$</td>
<td style="text-align:right;border:1px solid black;">$latex d$</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">総計</th>
<td style="text-align:right;border:1px solid black;">30</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">50</td>
</tr>
</tbody>
</table>
を考えたとき、観測された
<table id="observed" style="width:auto;border-collapse:collapse;">
<thead>
<tr>
<th style="text-align:center;border:1px solid black;"></th>
<th style="text-align:center;border:1px solid black;">有り</th>
<th style="text-align:center;border:1px solid black;">無し</th>
<th style="text-align:center;border:1px solid black;">総計</th>
</tr>
</thead>
<tbody>
<tr>
<th style="text-align:center;border:1px solid black;">女性</th>
<td style="text-align:right;border:1px solid black;">12</td>
<td style="text-align:right;border:1px solid black;">13</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">男性</th>
<td style="text-align:right;border:1px solid black;">18</td>
<td style="text-align:right;border:1px solid black;">7</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">総計</th>
<td style="text-align:right;border:1px solid black;">30</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">50</td>
</tr>
</tbody>
</table>
になる確率$latex P_o$は$latex \displaystyle \frac{{}_{25}C_{12} \times {}_{25}C_{18}}{{}_{50}C_{30}}$で求められます。ここで、$latex {_n}C_k$は相異なる$latex n$種のものから重複なく$latex k$種選ぶような組合せが何通りあるかを表します。

<a href="#fixed_marginal">周辺合計を固定した分割表</a>は、観測された分割表（$latex a$=12、$latex b$=13、$latex c$=18、$latex d$=7）を含め多数存在し得ます。周辺合計の中で最小である愛着無しの列周辺合計20に着目すると、$latex b + d$=20、0≦$latex b$≦20、0≦$latex d$≦20を満たす21の分割表が考えられます。21のうちいくつかの分割表を以下に示します。
<table id="i=1" style="width:auto;border-collapse:collapse;">
<caption style="text-align:center;border:none;">$latex b$=0、$latex d$=20の場合</caption>
<thead>
<tr>
<th style="text-align:center;border:1px solid black;"></th>
<th style="text-align:center;border:1px solid black;">有り</th>
<th style="text-align:center;border:1px solid black;">無し</th>
<th style="text-align:center;border:1px solid black;">総計</th>
</tr>
</thead>
<tbody>
<tr>
<th style="text-align:center;border:1px solid black;">女性</th>
<td style="text-align:right;border:1px solid black;">25</td>
<td style="text-align:right;border:1px solid black;">0</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">男性</th>
<td style="text-align:right;border:1px solid black;">5</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">総計</th>
<td style="text-align:right;border:1px solid black;">30</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">50</td>
</tr>
</tbody>
</table>
<table id="i=2" style="width:auto;border-collapse:collapse;">
<caption style="text-align:center;border:none;">$latex b$=1、$latex d$=19の場合</caption>
<thead>
<tr>
<th style="text-align:center;border:1px solid black;"></th>
<th style="text-align:center;border:1px solid black;">有り</th>
<th style="text-align:center;border:1px solid black;">無し</th>
<th style="text-align:center;border:1px solid black;">総計</th>
</tr>
</thead>
<tbody>
<tr>
<th style="text-align:center;border:1px solid black;">女性</th>
<td style="text-align:right;border:1px solid black;">24</td>
<td style="text-align:right;border:1px solid black;">1</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">男性</th>
<td style="text-align:right;border:1px solid black;">6</td>
<td style="text-align:right;border:1px solid black;">19</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">総計</th>
<td style="text-align:right;border:1px solid black;">30</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">50</td>
</tr>
</tbody>
</table>
<table id="i=11" style="width:auto;border-collapse:collapse;">
<caption style="text-align:center;border:none;">$latex b$=10、$latex d$=10の場合</caption>
<thead>
<tr>
<th style="text-align:center;border:1px solid black;"></th>
<th style="text-align:center;border:1px solid black;">有り</th>
<th style="text-align:center;border:1px solid black;">無し</th>
<th style="text-align:center;border:1px solid black;">総計</th>
</tr>
</thead>
<tbody>
<tr>
<th style="text-align:center;border:1px solid black;">女性</th>
<td style="text-align:right;border:1px solid black;">15</td>
<td style="text-align:right;border:1px solid black;">10</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">男性</th>
<td style="text-align:right;border:1px solid black;">15</td>
<td style="text-align:right;border:1px solid black;">10</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">総計</th>
<td style="text-align:right;border:1px solid black;">30</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">50</td>
</tr>
</tbody>
</table>
<table id="i=20" style="width:auto;border-collapse:collapse;">
<caption style="text-align:center;border:none;">$latex b$=19、$latex d$=1の場合</caption>
<thead>
<tr>
<th style="text-align:center;border:1px solid black;"></th>
<th style="text-align:center;border:1px solid black;">有り</th>
<th style="text-align:center;border:1px solid black;">無し</th>
<th style="text-align:center;border:1px solid black;">総計</th>
</tr>
</thead>
<tbody>
<tr>
<th style="text-align:center;border:1px solid black;">女性</th>
<td style="text-align:right;border:1px solid black;">6</td>
<td style="text-align:right;border:1px solid black;">19</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">男性</th>
<td style="text-align:right;border:1px solid black;">24</td>
<td style="text-align:right;border:1px solid black;">1</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">総計</th>
<td style="text-align:right;border:1px solid black;">30</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">50</td>
</tr>
</tbody>
</table>
<table id="i=21" style="width:auto;border-collapse:collapse;">
<caption style="text-align:center;border:none;">$latex b$=20、$latex d$=0の場合</caption>
<thead>
<tr>
<th style="text-align:center;border:1px solid black;"></th>
<th style="text-align:center;border:1px solid black;">有り</th>
<th style="text-align:center;border:1px solid black;">無し</th>
<th style="text-align:center;border:1px solid black;">総計</th>
</tr>
</thead>
<tbody>
<tr>
<th style="text-align:center;border:1px solid black;">女性</th>
<td style="text-align:right;border:1px solid black;">5</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">男性</th>
<td style="text-align:right;border:1px solid black;">25</td>
<td style="text-align:right;border:1px solid black;">0</td>
<td style="text-align:right;border:1px solid black;">25</td>
</tr>
<tr>
<th style="text-align:center;border:1px solid black;">総計</th>
<td style="text-align:right;border:1px solid black;">30</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">50</td>
</tr>
</tbody>
</table>
21の分割表を$latex a$、$latex b$、$latex c$、$latex d$とその分割表になる確率について<span id="focus_on_b">$latex b$が0から20まで変化する</span>ようにまとめると、以下のようになります。なお、便宜上、番号$latex i$を1から21まで与えてあります。
<table id="possibilities" style="width:auto;border-collapse:collapse;">
<caption style="text-align:center;border:none;">$latex a$、$latex b$、$latex c$、$latex d$とその確率$latex P_i$についてのまとめ</caption>
<thead>
<tr>
<th style="text-align:center;border:1px solid black;">番号$latex i$</th>
<th style="text-align:center;border:1px solid black;">$latex a$</th>
<th style="text-align:center;border:1px solid black;">$latex b$</th>
<th style="text-align:center;border:1px solid black;">$latex c$</th>
<th style="text-align:center;border:1px solid black;">$latex d$</th>
<th style="text-align:center;border:1px solid black;">確率$latex P_i$</th>
<th style="text-align:center;border:1px solid black;">備考</th>
</tr>
</thead>
<tbody>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">1</th>
<td style="text-align:right;border:1px solid black;">25</td>
<td style="text-align:right;border:1px solid black;">0</td>
<td style="text-align:right;border:1px solid black;">5</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:left;border:1px solid black;">$latex P_1 = {}_{25}C_{25}\times{}_{25}C_5\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"><a href="#i=1">$latex b$=0、$latex d$=20の場合</a></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">2</th>
<td style="text-align:right;border:1px solid black;">24</td>
<td style="text-align:right;border:1px solid black;">1</td>
<td style="text-align:right;border:1px solid black;">6</td>
<td style="text-align:right;border:1px solid black;">19</td>
<td style="text-align:left;border:1px solid black;">$latex P_2 = {}_{25}C_{24}\times{}_{25}C_6\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"><a href="#i=2">$latex b$=1、$latex d$=19の場合</a></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">3</th>
<td style="text-align:right;border:1px solid black;">23</td>
<td style="text-align:right;border:1px solid black;">2</td>
<td style="text-align:right;border:1px solid black;">7</td>
<td style="text-align:right;border:1px solid black;">18</td>
<td style="text-align:left;border:1px solid black;">$latex P_3 = {}_{25}C_{23}\times{}_{25}C_7\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">4</th>
<td style="text-align:right;border:1px solid black;">22</td>
<td style="text-align:right;border:1px solid black;">3</td>
<td style="text-align:right;border:1px solid black;">8</td>
<td style="text-align:right;border:1px solid black;">17</td>
<td style="text-align:left;border:1px solid black;">$latex P_4 = {}_{25}C_{22}\times{}_{25}C_8\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">5</th>
<td style="text-align:right;border:1px solid black;">21</td>
<td style="text-align:right;border:1px solid black;">4</td>
<td style="text-align:right;border:1px solid black;">9</td>
<td style="text-align:right;border:1px solid black;">16</td>
<td style="text-align:left;border:1px solid black;">$latex P_5 = {}_{25}C_{21}\times{}_{25}C_9\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">6</th>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">5</td>
<td style="text-align:right;border:1px solid black;">10</td>
<td style="text-align:right;border:1px solid black;">15</td>
<td style="text-align:left;border:1px solid black;">$latex P_6 = {}_{25}C_{20}\times{}_{25}C_{10}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">7</th>
<td style="text-align:right;border:1px solid black;">19</td>
<td style="text-align:right;border:1px solid black;">6</td>
<td style="text-align:right;border:1px solid black;">11</td>
<td style="text-align:right;border:1px solid black;">14</td>
<td style="text-align:left;border:1px solid black;">$latex P_7 = {}_{25}C_{19}\times{}_{25}C_{11}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">8</th>
<td style="text-align:right;border:1px solid black;">18</td>
<td style="text-align:right;border:1px solid black;">7</td>
<td style="text-align:right;border:1px solid black;">12</td>
<td style="text-align:right;border:1px solid black;">13</td>
<td style="text-align:left;border:1px solid black;">$latex P_8 = {}_{25}C_{18}\times{}_{25}C_{12}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr>
<th style="text-align:right;border:1px solid black;">9</th>
<td style="text-align:right;border:1px solid black;">17</td>
<td style="text-align:right;border:1px solid black;">8</td>
<td style="text-align:right;border:1px solid black;">13</td>
<td style="text-align:right;border:1px solid black;">12</td>
<td style="text-align:left;border:1px solid black;">$latex P_9 = {}_{25}C_{17}\times{}_{25}C_{13}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr>
<th style="text-align:right;border:1px solid black;">10</th>
<td style="text-align:right;border:1px solid black;">16</td>
<td style="text-align:right;border:1px solid black;">9</td>
<td style="text-align:right;border:1px solid black;">14</td>
<td style="text-align:right;border:1px solid black;">11</td>
<td style="text-align:left;border:1px solid black;">$latex P_{10} = {}_{25}C_{16}\times{}_{25}C_{14}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr>
<th style="text-align:right;border:1px solid black;">11</th>
<td style="text-align:right;border:1px solid black;">15</td>
<td style="text-align:right;border:1px solid black;">10</td>
<td style="text-align:right;border:1px solid black;">15</td>
<td style="text-align:right;border:1px solid black;">10</td>
<td style="text-align:left;border:1px solid black;">$latex P_{11} = {}_{25}C_{15}\times{}_{25}C_{15}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"><a href="#i=11">$latex b$=10、$latex d$=10の場合</a></td>
</tr>
<tr>
<th style="text-align:right;border:1px solid black;">12</th>
<td style="text-align:right;border:1px solid black;">14</td>
<td style="text-align:right;border:1px solid black;">11</td>
<td style="text-align:right;border:1px solid black;">16</td>
<td style="text-align:right;border:1px solid black;">9</td>
<td style="text-align:left;border:1px solid black;">$latex P_{12} = {}_{25}C_{14}\times{}_{25}C_{16}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr>
<th style="text-align:right;border:1px solid black;">13</th>
<td style="text-align:right;border:1px solid black;">13</td>
<td style="text-align:right;border:1px solid black;">12</td>
<td style="text-align:right;border:1px solid black;">17</td>
<td style="text-align:right;border:1px solid black;">8</td>
<td style="text-align:left;border:1px solid black;">$latex P_{13} = {}_{25}C_{13}\times{}_{25}C_{17}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="color:white;background-color:red;">
<th style="text-align:right;border:1px solid black;">14</th>
<td style="text-align:right;border:1px solid black;">12</td>
<td style="text-align:right;border:1px solid black;">13</td>
<td style="text-align:right;border:1px solid black;">18</td>
<td style="text-align:right;border:1px solid black;">7</td>
<td style="text-align:left;border:1px solid black;">$latex P_{14} = {}_{25}C_{12}\times{}_{25}C_{18}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;">$latex P_o$</td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">15</th>
<td style="text-align:right;border:1px solid black;">11</td>
<td style="text-align:right;border:1px solid black;">14</td>
<td style="text-align:right;border:1px solid black;">19</td>
<td style="text-align:right;border:1px solid black;">6</td>
<td style="text-align:left;border:1px solid black;">$latex P_{15} = {}_{25}C_{11}\times{}_{25}C_{19}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">16</th>
<td style="text-align:right;border:1px solid black;">10</td>
<td style="text-align:right;border:1px solid black;">15</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">5</td>
<td style="text-align:left;border:1px solid black;">$latex P_{16} = {}_{25}C_{10}\times{}_{25}C_{20}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">17</th>
<td style="text-align:right;border:1px solid black;">9</td>
<td style="text-align:right;border:1px solid black;">16</td>
<td style="text-align:right;border:1px solid black;">21</td>
<td style="text-align:right;border:1px solid black;">4</td>
<td style="text-align:left;border:1px solid black;">$latex P_{17} = {}_{25}C_9\times{}_{25}C_{21}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">18</th>
<td style="text-align:right;border:1px solid black;">8</td>
<td style="text-align:right;border:1px solid black;">17</td>
<td style="text-align:right;border:1px solid black;">22</td>
<td style="text-align:right;border:1px solid black;">3</td>
<td style="text-align:left;border:1px solid black;">$latex P_{18} = {}_{25}C_8\times{}_{25}C_{22}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">19</th>
<td style="text-align:right;border:1px solid black;">7</td>
<td style="text-align:right;border:1px solid black;">18</td>
<td style="text-align:right;border:1px solid black;">23</td>
<td style="text-align:right;border:1px solid black;">2</td>
<td style="text-align:left;border:1px solid black;">$latex P_{19} = {}_{25}C_7\times{}_{25}C_{23}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">20</th>
<td style="text-align:right;border:1px solid black;">6</td>
<td style="text-align:right;border:1px solid black;">19</td>
<td style="text-align:right;border:1px solid black;">24</td>
<td style="text-align:right;border:1px solid black;">1</td>
<td style="text-align:left;border:1px solid black;">$latex P_{20} = {}_{25}C_6\times{}_{25}C_{24}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"><a href="#i=20">$latex b$=19、$latex d$=1の場合</a></td>
</tr>
<tr style="background-color:pink;">
<th style="text-align:right;border:1px solid black;">21</th>
<td style="text-align:right;border:1px solid black;">5</td>
<td style="text-align:right;border:1px solid black;">20</td>
<td style="text-align:right;border:1px solid black;">25</td>
<td style="text-align:right;border:1px solid black;">0</td>
<td style="text-align:left;border:1px solid black;">$latex P_{21} = {}_{25}C_5\times{}_{25}C_{25}\div{}_{50}C_{30}$</td>
<td style="text-align:left;border:1px solid black;"><a href="#i=21">$latex b$=20、$latex d$=0の場合</a></td>
</tr>
</tbody>
</table>
なお、この例では$latex P_o = P_{14}$です。

</div>
</section>
<section>
<div id="section2.5">
<h3>p値の算出</h3>
<a href="../class04/#section1">有意水準</a>αと比較する確率<span id="p-value">p値を算出します。<span id="deriving_p-value">フィッシャーの正確確率検定では、$latex P_i \le P_o$を満たす$latex P_i$の総和がp値となります。</span><a href="#possibilities">$latex a$、$latex b$、$latex c$、$latex d$とその確率$latex P_i$についてのまとめの表</a>の赤い行が$latex P_o$の行、ピンクの行が$latex P_i \le P_o$を満たす$latex P_o$以外の行で、これらの$latex P_i$の総和がp値となります。</span>

</div>
</section>
<section>
<div id="section2.6">
<h3>判定</h3>
<a href="#p-value">p値</a>が<a href="../class04/#section1">有意水準</a>より大きいか小さいかで<a href="../class02/#null_hypothesis">帰無仮説</a>の受容か棄却かを決定します。
<dl>
 	<dt>p値 ≦ 有意水準α</dt>
 	<dd>帰無仮説H<sub>0</sub>を棄却する</dd>
 	<dt>p値 &gt; 有意水準α</dt>
 	<dd>帰無仮説H<sub>0</sub>を受容する</dd>
</dl>
</div>
</section>
<section>
<div id="section2.7">
<h3>Excelの操作</h3>
ここまで検定の理論について説明してきましたが、Excelを用いて<a href="#section2.1">練習問題1</a>に取り掛かりましょう。<a href="../class04/#section2.3">分割表の作成</a>は済んでいるとします。
<ol style="list-style-type:circled-decimal;">
 	<li><a href="#fixed_marginal">行周辺合計と列周辺合計とを固定した分割表</a>をExcelで追記します。ここで、"B10"、"B11"、"C10"、"C11"は文字を直接入力する必要がありますが、それ以外のセルは例えば"B9"セルに<code>=B4</code>と入力するなど、参照を活用してすでに入力されている情報を再利用しましょう。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2017/11/fisher_01input.png" alt="行周辺合計と列周辺合計とを固定した分割表の入力">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div><a href="#fixed_marginal">行周辺合計と列周辺合計とを固定した分割表</a>の入力</div>
</figcaption></figure>
</li>
 	<li><a href="#possibilities">$latex a$、$latex b$、$latex c$、$latex d$とその確率$latex P_i$についてまとめた表</a>を入力します。番号$latex i$と<q cite="#focus_on_b">0から20まで変化する</q>$latex b$とは数値を直接入力する必要がありますが、<a href="../class01/#autofill">オートフィル</a>を使って入力しましょう。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2017/11/fisher_02analysis.png" alt="a、b、c、dとその確率Piについてまとめた表の入力1">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div><a href="#possibilities">$latex a$、$latex b$、$latex c$、$latex d$とその確率$latex P_i$についてまとめた表</a>の入力1</div>
</figcaption></figure>
</li>
 	<li>$latex a$は25 - $latex b$、$latex d$は20 - $latex b$なので、<a href="http://infolit.uec.tmu.ac.jp/lit/contents/office2013/excel/01/#chapter17">数式</a>として入力します。なお、25は<code>D$10</code>として、20は<code>C$12</code>として、それぞれ参照することが可能です。同様に、$latex c$は30 - $latex a$あるいは25 - $latex d$で求められます。ここで25は<code>D$11</code>になります。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2017/11/fisher_03analysis.png" alt="a、b、c、dとその確率Piについてまとめた表の入力2">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div><a href="#possibilities">$latex a$、$latex b$、$latex c$、$latex d$とその確率$latex P_i$についてまとめた表</a>の入力2</div>
</figcaption></figure>
</li>
 	<li>$latex P_i$を求めます。$latex P_i$は$latex {}_{25}C_a \times {}_{25}C_c \div {}_{50}C_{30}$で求めることができます。ここで、$latex {}_nC_k$は<code>COMBIN</code>関数を使って<code>COMBIN(</code>$latex n$<code>,</code>$latex k$<code>)</code>と求めることができます（<a href="https://support.office.com/ja-jp/article/COMBIN-関数-12a3f276-0a21-423a-8de6-06990aaf638a"><code>COMBIN</code>関数</a>）。$latex a$は<code>J2</code>など、$latex c$は<code>L2</code>など、$latex {}_{25}C_a$の25は<code>D$10</code>、$latex {}_{25}C_c$の25は<code>D$11</code>、50は<code>D$12</code>、30は<code>B$12</code>と、参照を活用してすでに入力されている情報を再利用しましょう。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2017/11/fisher_04analysis.png" alt="a、b、c、dとその確率Piについてまとめた表の入力3">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div><a href="#possibilities">$latex a$、$latex b$、$latex c$、$latex d$とその確率$latex P_i$についてまとめた表</a>の入力3</div>
</figcaption></figure>
</li>
 	<li><q cite="#deriving_p-value">$latex P_i \le P_o$を満たす$latex P_i$の総和</q>を求めるために、$latex P_i \le P_o$を満たせば1、満たさなければ0を入力します。ここで$latex P_o$は"N15"セルに入力されているので、"O2"セルに<code>=IF(N2&lt;=N$15,1,0)</code>と入力し、<a href="../class01/#autofill">オートフィル</a>を使ってその他のセルにも入力します。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2017/11/fisher_05analysis.png" alt="Pi ≦ Poの入力">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>$latex P_i \le P_o$の入力</div>
</figcaption></figure>
</li>
 	<li>p値を<q cite="#deriving_p-value">$latex P_i \le P_o$を満たす$latex P_i$の総和</q>として求めるために、以下のように入力します。
<ul>
 	<li>"P23"：<code>=SUMPRODUCT(N2:N22,O2:O22)</code></li>
</ul>
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2017/11/fisher_06analysis.png" alt="p値の導出">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>p値の導出</div>
</figcaption></figure>
なお、<code>SUMPRODUCT</code>関数は、指定された範囲の対応するセル同士の積の和を求めます（<a href="https://support.office.com/ja-jp/article/SUMPRODUCT-関数-16753e75-9f68-4874-94ac-4d2145a2fd2e"><code>SUMPRODUCT</code>関数</a>）。$latex P_i \le P_o$を満たす場合に$latex P_i \times 1$、満たさない場合に$latex P_i \times 0$するので、$latex P_i \le P_o$を満たす$latex P_i$だけの総和を求めることができます。</li>
</ol>
</div>
</section>
<section>
<div id="section2.8">
<h3>結果</h3>
<a href="#p_of_W">p値</a> = 0.14816が求まりました。<a href="#possibilities">$latex a$、$latex b$、$latex c$、$latex d$とその確率$latex P_i$についてのまとめの表</a>の行の色を踏まえて、番号$latex i$と対応する確率$latex P_i$とをグラフにすると図のようになります。
<figure style="display:table;"><img src="https://fujiyoshimasaakitmu.files.wordpress.com/2017/11/fisher_07graph1.png" alt="p値の図示">

<figcaption style="display:table-caption;caption-side:bottom;text-align:center;">
<div>p値の図示</div>
</figcaption></figure>
設定した<a href="../class04/#section1">有意水準</a>αは0.05です。p値 = 0.14816 &gt; 有意水準α = 0.05であるので、<a href="../class02/#null_hypothesis">帰無仮説</a>H<sub>0</sub>は棄却されません。したがって、男性と女性とで地域の愛着に違いがあるとはいえません。

</div>
</section></div>
</section>

<hr>

<footer id="copyright">本教材に掲載する製品名は、一般に各開発メーカの商標、または登録商標です。
© 2017 Masaaki FUJIYOSHI.</footer>
